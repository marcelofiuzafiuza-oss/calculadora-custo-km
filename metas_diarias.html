<!doctype html><!--force-refresh-->
<html lang="pt-BR">
<head>
  <!-- FORCE NO-CACHE PARA GARANTIR QUE O GITHUB PAGE SEMPRE PEGUE A √öLTIMA VERS√ÉO -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<script>
  /* üîÑ Limpa cache automaticamente quando voc√™ mudar a vers√£o */
  (function () {
    const version = "v1.0.7"; 
    if (localStorage.getItem("maxrota_version") !== version) {
      localStorage.setItem("maxrota_version", version);
      window.location.reload(true);
    }
  })();
</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MAX ROTA DI√ÅRIO</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<style>

/* ===============================
   SISTEMA DE TEMAS COMPLETO
=============================== */

:root {
  --accent: #10b981;
  --accent2: #3b82f6;

  --bg1: #041226;
  --bg2: #2a1160;

  --card: rgba(255, 255, 255, 0.06);
  --text: #e6eef6;
  --muted: #9aa6b2;

  --radius: 16px;
  --scale: 1.02;
}

body.light-mode {
  --bg1: #f7f7f7;
  --bg2: #d9e4ff;

  --text: #0f172a;
  --muted: #475569;

  --card: rgba(255,255,255,0.9);
  --accent: #2563eb;
  --accent2: #7c3aed;
}

/* PALETAS PERSONALIZADAS */
body.accent-green { --accent:#10b981; --accent2:#34d399; }
body.accent-orange { --accent:#f97316; --accent2:#fb923c; }
body.accent-yellow { --accent:#facc15; --accent2:#fbbf24; }
body.accent-red { --accent:#ef4444; --accent2:#f87171; }
body.accent-pink { --accent:#ec4899; --accent2:#f472b6; }

/* ===============================
   BASE VISUAL
=============================== */

html, body { height: 100%; margin: 0; padding: 0; }

body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
  color: var(--text);
  padding: 20px;
  transform: scale(var(--scale));
  transform-origin: top left;
  transition: 0.25s ease;
}

.wrap { max-width: 1200px; margin: 0 auto; }

/* ===============================
   CARDS
=============================== */

.card {
  background: var(--card);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  padding: 18px;
  margin-bottom: 18px;
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 12px 26px rgba(0,0,0,0.32);
  transition: background 0.25s ease, color 0.25s ease;
}

/* ===============================
   HEADER
=============================== */

.header-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
}

.logo-img {
  height: 80px;
  width: auto;
  border-radius: 14px;
}

/* ===============================
   BOT√ÉO DIA / NOITE
=============================== */

.theme-btn {
  background: linear-gradient(120deg, var(--accent), var(--accent2));
  color: #fff;
  padding: 10px 16px;
  border-radius: 14px;
  font-weight: 800;
  border: none;
  cursor: pointer;
  box-shadow: 0 10px 26px rgba(0,0,0,0.4);
  transition: 0.2s ease;
}

/* ===============================
   BOLINHAS DE COR
=============================== */

.theme-dots { display: flex; gap: 10px; }

.color-dot {
  width: 28px;
  height: 28px;
  border-radius: 999px;
  border: 2px solid rgba(255,255,255,0.3);
  cursor: pointer;
  transition: 0.2s ease;
}

/* ===============================
   BOT√ÉO ESCONDER VALORES
=============================== */

.toggle-btn {
  padding: 11px 16px;
  border-radius: 14px;
  background: linear-gradient(120deg, var(--accent2), var(--accent));
  color: #fff;
  border: none;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 10px 20px rgba(0,0,0,0.35);
}

/* ===============================
   R√ÅDIOS
=============================== */

.radio-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}

.station-btn {
  padding: 14px;
  height: 60px;
  border-radius: 14px;
  color: #fff;
  font-weight: 900;
  border: 0;
  cursor: pointer;
  transition: 0.12s;
  font-size: 15px;
}

.station-btn.active {
  box-shadow: 0 14px 32px rgba(0,0,0,0.45);
  transform: translateY(-3px);
}

/* ===============================
   META
=============================== */

.meta-row input {
  padding: 14px;
  font-weight: 900;
  font-size: 18px;
  border-radius: 14px;
  border: 2px solid rgba(255,255,255,0.1);
}

/* PROGRESS BAR */
.progress-container {
  height: 48px;
  border-radius: 16px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.08);
  overflow: hidden;
  position: relative;
}

.progress-bar {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  background: linear-gradient(120deg, var(--accent), var(--accent2));
  width: 0%;
  transition: width 0.3s ease;
}

.progress-text {
  position: absolute;
  width: 100%;
  height: 100%;
  line-height: 48px;
  text-align: center;
  font-weight: 900;
  font-size: 16px;
}

/* ===============================
   TIMER
=============================== */

.big-time {
  font-weight: 900;
  font-size: 22px;
}

/* ===============================
   INPUTS GERAIS
=============================== */

input {
  background: rgba(255,255,255,0.05);
  border: 2px solid rgba(255,255,255,0.08);
  color: var(--text);
  font-weight: 900;
  border-radius: 14px;
  padding: 12px;
  font-size: 16px;
}

/* ===============================
   BOT√ïES GERAIS
=============================== */

.btn {
  padding: 12px 18px;
  border-radius: 14px;
  background: linear-gradient(120deg, var(--accent), var(--accent2));
  color: #fff;
  border: none;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 12px 26px rgba(0,0,0,0.35);
}

.btn-ghost {
  padding: 12px 18px;
  border-radius: 14px;
  background: rgba(255,255,255,0.05);
  border: 2px solid rgba(255,255,255,0.1);
  font-weight: 800;
  cursor: pointer;
  color: var(--muted);
}

/* ===============================
   ESCONDER VALORES
=============================== */

.hidden-value {
  visibility: hidden;
  position: relative;
}

.hidden-value::after {
  content: "****";
  visibility: visible;
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  color: var(--text);
  font-weight: 900;
}

</style>
</head>
<body class="accent-green">
<div class="wrap">

  <!-- HEADER -->
  <header class="card header-card" role="banner" aria-label="Cabe√ßalho MAX ROTA">
    <div style="display:flex;align-items:center;gap:12px">
      <img id="logoImg" class="logo-img"
           src="https://i.postimg.cc/3RWn008g/Chat-GPT-Image-12-de-nov-de-2025-14-32-56.png"
           alt="MAX ROTA DI√ÅRIO">
      <div>
        <h1 style="margin:0;font-size:20px">MAX ROTA DI√ÅRIO</h1>
        <div class="small muted">Painel do Motorista</div>
      </div>
    </div>

    <div class="header-actions-container">
      <!-- Controle de Tema -->
      <div class="theme-controls">
        <button id="autoThemeBtn" class="theme-btn" title="Ativar modo autom√°tico">Auto üåó</button>

        <div class="theme-dots" style="margin-left:8px">
          <button class="color-dot" data-accent="green"  style="background:#10b981"></button>
          <button class="color-dot" data-accent="orange" style="background:#f97316"></button>
          <button class="color-dot" data-accent="yellow" style="background:#facc15"></button>
          <button class="color-dot" data-accent="red"    style="background:#ef4444"></button>
          <button class="color-dot" data-accent="pink"   style="background:#ec4899"></button>
        </div>
      </div>

      <!-- Ocultar valores -->
      <button id="toggleValuesBtn" class="toggle-btn">üëÅÔ∏è Esconder</button>
    </div>
  </header>

  <!-- R√ÅDIOS -->
  <section class="card radio-card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="margin:0;font-size:16px">üéß Esta√ß√µes</h2>
      <button onclick="logout()" class="btn btn-small">Sair</button>
    </div>

    <div id="stationButtons" class="radio-grid">

      <!-- Mantive apenas as r√°dios que funcionam -->
      <button class="station-btn" data-src="https://live.hunter.fm/pop_high"     style="background:#10b981">Hunter Pop</button>
      <button class="station-btn" data-src="https://live.hunter.fm/pop2k_high"   style="background:#06b6d4">Pop2K</button>
      <button class="station-btn" data-src="https://live.hunter.fm/rock_high"   style="background:#ef4444">Rock</button>
      <button class="station-btn" data-src="https://live.hunter.fm/sertanejo_high"  style="background:#f59e0b">Sertanejo</button>

      <button class="station-btn" data-src="https://stream.radioparadise.com/mp3-192" style="background:#111827">RadioParadise</button>
      <button class="station-btn" data-src="http://listen.181fm.com/181-beat_128k.mp3" style="background:#0ea5e9">181 HipHop</button>
      <button class="station-btn" data-src="https://ice1.somafm.com/beatblender-128-mp3" style="background:#7c3aed">House</button>
      <button class="station-btn" data-src="https://ice1.somafm.com/groovesalad-128-mp3" style="background:#2563eb">Eletr√¥nica</button>

    </div>

    <div class="radio-player mt-4">
      <audio id="radioPlayer" controls preload="none"></audio>
      <div style="display:flex;flex-direction:column;gap:8px;margin-left:12px">
        <button id="stopRadioBtn" class="btn-ghost">Parar R√°dio</button>
        <div id="nowPlaying" class="small muted">Nenhuma r√°dio selecionada.</div>
      </div>
    </div>
  </section>

  <!-- META -->
  <section class="card meta-card">
    <h2 style="margin:0 0 8px 0;font-size:16px">üéØ Meta Di√°ria</h2>

    <div class="meta-row mt-3">
      <input id="metaInput" type="number" placeholder="Ex: 300" />
      <button id="setMetaBtn" class="btn">Salvar Meta</button>
    </div>

    <div class="progress-container mt-4">
      <div id="progressBar" class="progress-bar"></div>
      <div id="progressText" class="progress-text">0%</div>
    </div>

    <div id="metaMessage" class="small muted mt-2">Defina a meta para acompanhar o progresso.</div>
  </section>

  <!-- KM & TIMER -->
  <section class="card km-card">
    <h2 style="margin:0 0 8px 0;font-size:16px">üöó Jornada e KM</h2>

    <div class="grid-4 mt-3">
      <div>
        <label class="small muted">KM Inicial</label>
        <input id="kmInicial" type="number" placeholder="Ex: 150000">
      </div>

      <div>
        <label class="small muted">KM Final</label>
        <input id="kmFinal" type="number" placeholder="Ex: 150250">
      </div>

      <div>
        <label class="small muted">Tempo Trabalhado</label>
        <div id="tempoTrabalhado" class="big-time">00:00:00</div>
      </div>

      <div>
        <label class="small muted">KM Rodados</label>
        <div id="kmRodados" class="big-time">0 km</div>
      </div>
    </div>

    <div class="km-actions">
      <button id="toggleStartBtn" class="btn">Iniciar</button>
      <button id="finalizeBtn" class="btn-ghost">Finalizar Dia</button>
      <button id="saveKmBtn" class="btn">Salvar KM</button>
    </div>
  </section>

  <!-- LAN√áAMENTOS -->
  <section class="card lancamentos-card grid-2cols">
    <div>
      <h3 style="margin:0 0 8px 0;font-size:15px">‚ûï Entradas</h3>

      <div class="input-row mt-2">
        <input id="valorEntrada" type="number" placeholder="R$">
        <button id="addEntradaBtn" class="btn">Adicionar</button>
      </div>

      <div class="apps-grid mt-2">
        <button class="app-btn" data-cat="Uber" style="background:#000">Uber</button>
        <button class="app-btn" data-cat="99" style="background:#facc15;color:#111">99</button>
        <button class="app-btn" data-cat="inDriver" style="background:#10b981">inDriver</button>
        <button class="app-btn" data-cat="Particular" style="background:#6b7280">Particular</button>
        <button class="app-btn" data-cat="Loja" style="background:#1e3a8a">Loja</button>
        <button class="app-btn" data-cat="Doa√ß√£o" style="background:#8b5cf6">Doa√ß√£o</button>
      </div>
    </div>

    <div>
      <h3 style="margin:0 0 8px 0;font-size:15px">‚ûñ Sa√≠das</h3>

      <div class="input-row mt-2">
        <input id="valorSaida" type="number" placeholder="R$">
        <button id="addSaidaBtn" class="btn">Adicionar</button>
      </div>

      <div class="gastos-grid mt-2">
        <button class="gasto-btn" data-cat="Combust√≠vel" style="background:#ef4444">Combust√≠vel</button>
        <button class="gasto-btn" data-cat="Alimenta√ß√£o" style="background:#8b5cf6">Alimenta√ß√£o</button>
        <button class="gasto-btn" data-cat="Manuten√ß√£o" style="background:#6b7280">Manuten√ß√£o</button>
        <button class="gasto-btn" data-cat="Outros" style="background:#374151">Outros</button>
      </div>
    </div>
  </section>

  <!-- Lan√ßamentos Recentes -->
  <section class="card recentes-card">
    <h3 style="margin:0 0 8px 0;font-size:15px">Lan√ßamentos Recentes</h3>
    <div id="lancamentosList" class="launch-list">
      <div class="muted small text-center">Nenhum lan√ßamento ainda.</div>
    </div>
  </section>

  <!-- Resumo por categoria -->
  <section class="card resumo-cat">
    <h3 style="margin:0 0 8px 0;font-size:15px">Resumo por Categoria</h3>
    <div id="resumoCategorias" class="resumo-grid"></div>
  </section>

  <!-- M√âTRICAS -->
  <section class="card metric-card">
    <h3 style="margin:0 0 8px 0;font-size:15px">M√©tricas</h3>

    <div class="metric-grid mt-3">
      <div class="metric-col">
        <div class="metric-title">Bruto Apps</div>
        <div id="metricGanhosApps" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Total Bruto</div>
        <div id="metricGanhosTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Gastos</div>
        <div id="metricGastosTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Lucro</div>
        <div id="metricLucroTotal" class="metric-value">R$ 0,00</div>
      </div>
    </div>
  </section>
  <!-- A√á√ïES -->
  <section class="card actions-card">
    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <button id="saveAndResetBtn" class="btn">Salvar Resumo & Resetar Dia</button>
      <button id="exportBtn" class="btn-ghost">Exportar Resumo (JSON)</button>
      <button id="viewHistoryBtn" class="btn-ghost">Ver Hist√≥rico</button>
    </div>

    <div id="historyPanel" class="history-panel mt-4 hidden"></div>
  </section>

  <!-- RESUMO FINAL -->
  <section class="card final-resumo">
    <h3 style="margin:0 0 8px 0;font-size:15px">Resumo Final</h3>

    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:8px">
      <div class="mini-card">
        <div class="muted">Apps</div>
        <div id="finalTotalApps" class="metric-value">R$ 0,00</div>
      </div>

      <div class="mini-card">
        <div class="muted">Loja</div>
        <div id="finalTotalLoja" class="metric-value">R$ 0,00</div>
      </div>

      <div class="mini-card">
        <div class="muted">Doa√ß√µes</div>
        <div id="finalTotalDoacao" class="metric-value">R$ 0,00</div>
      </div>

      <div class="mini-card-total">
        <div class="muted" style="opacity:0.9">Total Geral</div>
        <div id="finalTotalGeral" class="metric-value">R$ 0,00</div>
      </div>
    </div>
  </section>

  <footer class="small muted" style="text-align:center;margin-top:10px">
    Sincronizado com Firebase ‚úî
  </footer>

</div> <!-- wrap -->

<div id="confettiRoot" class="confetti"></div>

<!-- ==============================
     SCRIPT PRINCIPAL PARTE FINAL
=================================-->
<script type="module">

/* ===========================
   A√á√ïES DO HIST√ìRICO
=========================== */
viewHistoryBtn.addEventListener("click", () => {
  if (historyPanel.classList.contains("hidden")) {
    renderHistory();
    historyPanel.classList.remove("hidden");
    viewHistoryBtn.textContent = "Ocultar Hist√≥rico";
  } else {
    historyPanel.classList.add("hidden");
    viewHistoryBtn.textContent = "Ver Hist√≥rico";
  }
});

function renderHistory() {
  if (!state.savedDays?.length) {
    historyPanel.innerHTML = `<div class="muted small">Nenhum dia salvo.</div>`;
    return;
  }

  historyPanel.innerHTML = "";

  state.savedDays.forEach(dia => {
    const card = document.createElement("div");
    card.className = "card";
    card.style.padding = "10px";
    card.style.marginBottom = "10px";

    const valueClass = state.valuesHidden ? "hidden-value" : "";

    card.innerHTML = `
      <div><strong>${new Date(dia.date).toLocaleDateString("pt-BR")}</strong></div>
      <div>Meta: <span class="${valueClass}">${formatBRL(dia.meta)}</span></div>
      <div>Bruto: <span class="${valueClass}">${formatBRL(dia.ganhosApps + dia.ganhosLoja)}</span></div>
      <div>Gastos: <span class="${valueClass}">${formatBRL(dia.gastos)}</span></div>
      <div>Lucro: <span class="${valueClass}">${formatBRL(dia.lucro)}</span></div>
      <div>KM: <span class="${valueClass}">${dia.km}</span></div>
    `;

    historyPanel.appendChild(card);
  });
}

/* ===========================
   SALVAR META
=========================== */
setMetaBtn.addEventListener("click", () => {
  const v = Number(metaInput.value);
  if (!v || v <= 0) return alert("Digite uma meta v√°lida.");

  state.meta = v;
  state.celebrated = false;

  saveState();
  updateUI();
});

/* ===========================
   CARGA INICIAL DE ESTADO
=========================== */
loadState();
updateUI();

</script>


<!-- ===========================================
       FIREBASE CORE
===========================================-->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBXkQlm0TbCsCdVGil8-5kGWbtj07SKXwA",
  authDomain: "maxrota.firebaseapp.com",
  projectId: "maxrota",
  storageBucket: "maxrota.firebasestorage.app",
  messagingSenderId: "425002957978",
  appId: "1:425002957978:web:1e4f38239e552de452f323",
  measurementId: "G-RBK7LM483D"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.__FIREBASE__ = { auth, db };
window.auth = auth;
</script>

<!-- ===========================================
       AUTH GUARD
===========================================-->
<script type="module">
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

onAuthStateChanged(window.auth, user => {
  if (!user) {
    location.href = "login.html";
    return;
  }
  window.__USER_UID__ = user.uid;
  window.loadState();
});
</script>

<!-- ===========================================
       LOGOUT
===========================================-->
<script type="module">
import { signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

window.logout = async () => {
  await signOut(window.auth);
  location.href = "login.html";
};
</script>

<!-- ===========================================
      SYNC EM TEMPO REAL (15s)
===========================================-->
<script type="module">
setInterval(() => {
  if (window.__USER_UID__) window.loadState();
}, 15000);
</script>

</body>
</html>
