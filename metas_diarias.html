<!-- PARTE 1/3 - metas_diarias.html -->
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MAX ROTA DI√ÅRIO</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <!-- Chart.js (preservado caso queira reabilitar gr√°ficos no futuro) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

  <style>
  /* ===========================
     MAX ROTA ‚Äì ESTILO GLOBAL
     =========================== */
  :root {
    --accent: #10b981;
    --bg1: #041226;
    --bg2: #2a1160;
    --text: #e6eef6;
    --muted: #9aa6b2;
    --card: rgba(255, 255, 255, 0.06);
    --radius: 14px;
    --scale: 1.02;
  }
  html,body{height:100%;margin:0;padding:0}
  body{
    font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    color:var(--text);padding:20px;transform:scale(var(--scale));transform-origin:top left;
  }
  .wrap{max-width:1200px;margin:0 auto}
  .card{background:var(--card);backdrop-filter:blur(6px);border-radius:16px;padding:18px;margin-bottom:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 26px rgba(0,0,0,0.35)}
  .header-card{display:flex;justify-content:space-between;align-items:center; flex-wrap: wrap; gap: 10px;}
  .logo-img{height:74px;width:auto;border-radius:12px}
  .theme-controls{display:flex;align-items:center;gap:12px}
  .theme-btn{background:linear-gradient(120deg,var(--accent),#3b82f6);color:#fff;padding:10px 14px;border-radius:12px;border:none;font-weight:700;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,0.3)}
  .theme-dots{display:flex;gap:10px}
  .color-dot{width:30px;height:30px;border-radius:999px;border:2px solid rgba(255,255,255,0.12);cursor:pointer;box-shadow:0 6px 14px rgba(0,0,0,0.3)}
  .radio-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .station-btn{padding:14px;border-radius:12px;color:#fff;font-weight:800;border:0;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.12s;font-size:16px;height:56px}
  .station-btn.active{box-shadow:0 10px 26px rgba(0,0,0,0.5);transform:translateY(-3px)}
  .radio-player{margin-top:12px;display:flex;align-items:center;gap:12px}
  .meta-row{display:flex;gap:12px}
  .meta-row input{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.03);color:var(--text);font-weight:800;font-size:16px}
  .progress-container{height:44px;border-radius:22px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);overflow:hidden;position:relative}
  .progress-bar{position:absolute;left:0;top:0;height:100%;background:linear-gradient(120deg,var(--accent),#2563eb);width:0%;animation:waveMove 3.5s linear infinite;background-size:200% 200%}
  @keyframes waveMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  .progress-text{position:absolute;width:100%;height:100%;line-height:44px;text-align:center;font-weight:900;font-size:15px}
  .progress-bubbles{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;overflow:hidden}
  .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .grid-4 input{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.03);color:var(--text);font-weight:700;font-size:15px}
  .big-time{font-size:20px;font-weight:900}
  .km-actions{margin-top:12px;display:flex;gap:12px;flex-wrap:wrap}
  .btn{padding:12px 16px;border-radius:12px;background:linear-gradient(120deg,var(--accent),#7c3aed);border:none;font-weight:800;cursor:pointer;color:#fff;font-size:15px;box-shadow:0 8px 20px rgba(0,0,0,0.3)}
  .btn-ghost{padding:12px 16px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);font-weight:700;cursor:pointer;color:var(--muted)}
  .grid-2cols{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .input-row{display:flex;gap:12px}
  .input-row input{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.03);color:var(--text);font-weight:700;font-size:15px}
  .apps-grid,.gastos-grid{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .app-btn,.gasto-btn{padding:12px 14px;border:none;border-radius:12px;cursor:pointer;font-weight:900;color:#fff;font-size:15px;display:flex;align-items:center;justify-content:center;min-width:120px}
  .launch-list{max-height:300px;overflow-y:auto;padding:6px}
  .launch-item{display:flex;justify-content:space-between;border-bottom:1px dashed rgba(255,255,255,0.06);padding:10px 6px;border-radius:10px}
  .metric-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px}
  .metric-col{padding:12px;border-radius:12px;background:rgba(255,255,255,0.04)}
  .metric-title{font-size:13px;color:var(--muted)}
  .metric-value{margin-top:8px;font-size:18px;font-weight:900}
  .resumo-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
  .history-panel{background:rgba(255,255,255,0.03);padding:12px;border-radius:12px}
  .confetti{pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:9999}
  .confetti .c{position:absolute;width:10px;height:14px;opacity:0.95}
  .accent-green{--accent:#10b981}
  .accent-orange{--accent:#f97316}
  .accent-yellow{--accent:#facc15}
  .accent-red{--accent:#ef4444}
  .accent-pink{--accent:#ec4899}
  body.light-mode{--bg1:#f5f7fb;--bg2:#e8f0ff;--text:#0b1220;--muted:#566170;--card:rgba(255,255,255,0.9)}
  .muted{color:var(--muted)}
  .small{font-size:13px}
  /* Estilo para valores escondidos, mant√©m o espa√ßo */
  .hidden-value-mask {
    color: transparent;
    text-shadow: 0 0 8px rgba(0,0,0,0.9);
    font-size: 10px;
  }
  .hidden-value {
    visibility: hidden;
    position: relative;
  }
  .hidden-value::after {
    content: '****';
    visibility: visible;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    color: var(--text);
    text-align: inherit;
    line-height: inherit;
    font-size: inherit;
    font-weight: inherit;
  }
  /* Estilo para o bot√£o no header */
  .header-actions-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: flex-end;
  }
  .toggle-btn {
    padding: 6px 10px;
    border-radius: 8px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.08);
    font-weight: 600;
    cursor: pointer;
    color: var(--text);
    font-size: 13px;
    white-space: nowrap;
    width: fit-content;
  }

  @media(max-width:1000px){body{transform:scale(1.00)}.grid-4{grid-template-columns:repeat(2,1fr)}.grid-2cols{grid-template-columns:1fr}.wrap{padding:8px)}
  </style>
</head>

<body class="accent-green">
  <div class="wrap">
 <!-- PARTE 2/3 - corpo dos cards (cole ap√≥s a abertura do <div class="wrap"> da PARTE 1) -->
  <!-- HEADER (conte√∫do do card) -->
  <header class="card header-card" role="banner" aria-label="Cabe√ßalho MAX ROTA">
    <div style="display:flex;align-items:center;gap:12px">
      <img id="logoImg" class="logo-img" src="https://i.postimg.cc/3RWn008g/Chat-GPT-Image-12-de-nov-de-2025-14-32-56.png" alt="MAX ROTA DI√ÅRIO">
      <div>
        <h1 style="margin:0;font-size:20px">MAX ROTA DI√ÅRIO</h1>
        <div class="small muted">Painel do Motorista</div>
      </div>
    </div>

    <div class="header-actions-container">
      <!-- Controles de Tema/Cor -->
      <div class="theme-controls" aria-hidden="false">
        <button id="autoThemeBtn" class="theme-btn" title="Ativar modo autom√°tico dia/noite">Auto üåó</button>
        <div class="theme-dots" role="toolbar" aria-label="Temas" style="margin-left:8px">
          <button class="color-dot" data-accent="green" style="background:#10b981" title="Verde"></button>
          <button class="color-dot" data-accent="orange" style="background:#f97316" title="Laranja"></button>
          <button class="color-dot" data-accent="yellow" style="background:#facc15" title="Amarelo"></button>
          <button class="color-dot" data-accent="red" style="background:#ef4444" title="Vermelho"></button>
          <button class="color-dot" data-accent="pink" style="background:#ec4899" title="Rosa"></button>
        </div>
      </div>
      
      <!-- Bot√£o de Ocultar Valores -->
      <button id="toggleValuesBtn" class="toggle-btn" aria-pressed="false" title="Mostrar/Esconder valores monet√°rios e de contagem">Esconder Valores</button>
    </div>
  </header>
  <!-- FIM DO HEADER -->

  <!-- R√ÅDIOS (SEGUNDO CARD) -->
  <section class="card radio-card" aria-label="R√°dios">
    <div style="display:flex; justify-content: space-between; align-items: center;">
      <h2 style="margin:0;font-size:16px">üéß Esta√ß√µes</h2>
      <button onclick="logout()" class="btn">Sair</button>
    </div>

    <div id="stationButtons" class="radio-grid" role="list" aria-label="Lista de r√°dios">
      <button class="station-btn" data-src="https://live.hunter.fm/pop_high" data-name="Hunter Pop" style="background:#10b981">Hunter Pop</button>
      <button class="station-btn" data-src="https://live.hunter.fm/pop2k_high" data-name="Hunter Pop2K" style="background:#06b6d4">Pop2K</button>
      <button class="station-btn" data-src="https://ice1.somafm.com/u80s-128-mp3" data-name="Flashback 80s" style="background:#8b5cf6">80s</button>
      <button class="station-btn" data-src="http://listen.181fm.com/181-power_128k.mp3" data-name="Power 181" style="background:#f97316">Power181</button>

      <button class="station-btn" data-src="https://live.hunter.fm/rock_high" data-name="Rock Classic" style="background:#ef4444">Rock</button>
      <button class="station-btn" data-src="https://live.hunter.fm/sertanejo_high" data-name="Sertanejo" style="background:#f59e0b">Sertanejo</button>
      <button class="station-btn" data-src="https://live.hunter.fm/hiphop_high" data-name="Hip Hop" style="background:#111827">HipHop</button>
      <button class="station-btn" data-src="https://live.hunter.fm/gospel_high" data-name="Crist√£" style="background:#facc15;color:#111">Crist√£</button>

      <button class="station-btn" data-src="https://ice1.somafm.com/groovesalad-128-mp3" data-name="GrooveSalad" style="background:#2563eb">Eletr√¥nica</button>
      <button class="station-btn" data-src="https://ice1.somafm.com/beatblender-128-mp3" data-name="BeatBlender" style="background:#7c3aed">House / Deep</button>
      <button class="station-btn" data-src="https://ice1.somafm.com/secretagent-128-mp3" data-name="Surf" style="background:#06b6d4">Surf</button>
      <button class="station-btn" data-src="https://ice1.somafm.com/dubstep-128-mp3" data-name="Reggae/Dub" style="background:#4ade80">Reggae</button>

      <button class="station-btn" data-src="https://live.hunter.fm/mpb_high" data-name="MPB Brasil" style="background:#1e3a8a">MPB</button>
      <button class="station-btn" data-src="https://stream.radioparadise.com/mp3-192" data-name="Radio Paradise" style="background:#111827">RadioParadise</button>
      <button class="station-btn" data-src="http://listen.181fm.com/181-beat_128k.mp3" data-name="181 HipHop" style="background:#0ea5e9">181 HipHop</button>
      <button class="station-btn" data-src="https://live.hunter.fm/mpb_high" data-name="MPB (alt)" style="background:#8b5cf6">MPB alt</button>
    </div>

    <div class="radio-player mt-4" aria-label="Player de r√°dio">
      <audio id="radioPlayer" controls preload="none" class="w-full" aria-label="Player de r√°dio"></audio>
      <div style="display:flex;flex-direction:column;gap:8px;margin-left:12px">
        <button id="stopRadioBtn" class="btn-ghost w-36" aria-label="Parar r√°dio">Parar R√°dio</button>
        <div id="nowPlaying" class="small muted" aria-live="polite">Nenhuma r√°dio selecionada.</div>
      </div>
    </div>
  </section>

  <!-- META -->
  <section class="card meta-card" aria-label="Meta di√°ria">
    <h2 style="margin:0 0 8px 0;font-size:16px">üéØ Meta Di√°ria</h2>

    <div class="meta-row mt-3" role="form" aria-label="Definir meta di√°ria">
      <input id="metaInput" type="number" placeholder="Ex: 300" aria-label="Valor da meta" />
      <button id="setMetaBtn" class="btn" aria-label="Salvar meta">Salvar Meta</button>
    </div>

    <div class="progress-container mt-4" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
      <div id="progressBar" class="progress-bar" style="width:0%"></div>
      <div id="progressBubbles" class="progress-bubbles" aria-hidden="true"></div>
      <div id="progressText" class="progress-text">0%</div>
    </div>

    <div id="metaMessage" class="small muted mt-2" aria-live="polite">Defina a meta para acompanhar o progresso.</div>
  </section>

  <!-- KM & TIMER -->
  <section class="card km-card" aria-label="Jornada e quilometragem">
    <h2 style="margin:0 0 8px 0;font-size:16px">üöó Jornada e KM</h2>

    <div class="grid-4 mt-3" role="group" aria-label="Campos de quilometragem e tempo">
      <div>
        <label class="small muted" for="kmInicial">KM Inicial</label>
        <input id="kmInicial" type="number" placeholder="Ex: 150000" aria-label="KM inicial" />
      </div>

      <div>
        <label class="small muted" for="kmFinal">KM Final</label>
        <input id="kmFinal" type="number" placeholder="Ex: 150250" aria-label="KM final" />
      </div>

      <div>
        <label class="small muted">Tempo Trabalhado</label>
        <div id="tempoTrabalhado" class="big-time" aria-live="polite">00:00:00</div>
      </div>

      <div>
        <label class="small muted">KM Rodados</label>
        <div id="kmRodados" class="big-time" aria-live="polite">0.0 km</div>
      </div>
    </div>

    <div class="km-actions">
      <button id="toggleStartBtn" class="btn mt-4" aria-pressed="false">Iniciar Expediente</button>
      <button id="finalizeBtn" class="btn-ghost mt-4">Finalizar Dia</button>
      <button id="saveKmBtn" class="btn mt-4">Salvar KM</button>
    </div>
  </section>

  <!-- LAN√áAMENTOS: Entradas / Sa√≠das -->
  <section class="card lancamentos-card grid-2cols" aria-label="Lan√ßamentos">
    <div>
      <h3 style="margin:0 0 8px 0;font-size:15px">‚ûï Entradas (Apps)</h3>

      <div class="input-row mt-2" role="form" aria-label="Lan√ßar entrada">
        <input id="valorEntrada" type="number" placeholder="Valor (R$)" aria-label="Valor de entrada" />
        <button id="addEntradaBtn" class="btn" aria-label="Adicionar entrada">Lan√ßar</button>
      </div>

      <div class="apps-grid mt-2" role="list" aria-label="Lista de apps">
        <button class="app-btn" data-cat="Uber" style="background:#000">Uber</button>
        <button class="app-btn" data-cat="99" style="background:#facc15;color:#111">99</button>
        <button class="app-btn" data-cat="inDriver" style="background:#10b981">inDriver</button>
        <button class="app-btn" data-cat="Particular" style="background:#6b7280">Particular</button>
        <button class="app-btn" data-cat="Loja" style="background:#1e3a8a">Loja</button>
        <button class="app-btn" data-cat="Doa√ß√£o" style="background:#8b5cf6">Doa√ß√£o</button>
      </div>
    </div>

    <div>
      <h3 style="margin:0 0 8px 0;font-size:15px">‚ûñ Sa√≠das (Gastos)</h3>

      <div class="input-row mt-2" role="form" aria-label="Lan√ßar gasto">
        <input id="valorSaida" type="number" placeholder="Valor (R$)" aria-label="Valor de sa√≠da" />
        <button id="addSaidaBtn" class="btn" aria-label="Adicionar gasto">Lan√ßar</button>
      </div>

      <div class="gastos-grid mt-2" role="list" aria-label="Principais gastos">
        <button class="gasto-btn" data-cat="Combust√≠vel" style="background:#ef4444">Combust√≠vel</button>
        <button class="gasto-btn" data-cat="Alimenta√ß√£o" style="background:#8b5cf6">Alimenta√ß√£o</button>
        <button class="gasto-btn" data-cat="Manuten√ß√£o" style="background:#6b7280">Manuten√ß√£o</button>
        <button class="gasto-btn" data-cat="Outros" style="background:#374151">Outros</button>
      </div>
    </div>
  </section>

  <!-- Lan√ßamentos recentes -->
  <section class="card recentes-card" aria-label="Lan√ßamentos recentes">
    <h3 style="margin:0 0 8px 0;font-size:15px">Lan√ßamentos Recentes</h3>
    <div id="lancamentosList" class="launch-list mt-2" aria-live="polite">
      <div class="muted small text-center">Nenhum lan√ßamento ainda.</div>
    </div>
  </section>

  <!-- Resumo por categoria -->
  <section class="card resumo-cat" aria-label="Resumo por categoria">
    <h3 style="margin:0 0 8px 0;font-size:15px">Resumo R√°pido por Categoria</h3>
    <div id="resumoCategorias" class="resumo-grid mt-2 small muted" role="list"></div>
  </section>

  <!-- M√âTRICAS -->
  <section class="card metric-card" aria-label="M√©tricas">
    <h3 style="margin:0 0 8px 0;font-size:15px">M√©tricas</h3>

    <div class="metric-grid mt-3">
      <div class="metric-col">
        <div class="metric-title">Ganhos Brutos ‚Äî Somente Apps</div>
        <div id="metricGanhosApps" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Ganhos Brutos ‚Äî Apps + Loja</div>
        <div id="metricGanhosTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Gastos Totais</div>
        <div id="metricGastosTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Lucro L√≠quido</div>
        <div id="metricLucroTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">M√©dia/Hora (Bruto)</div>
        <div id="metricMediaHoraBrutoTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">M√©dia/Hora (L√≠quido)</div>
        <div id="metricMediaHoraLiqTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Lucro / KM (L√≠quido)</div>
        <div id="metricLucroKmTotal" class="metric-value">R$ 0,00</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Entradas Apps</div>
        <div id="metricEntradasApps" class="metric-value">0</div>
      </div>

      <div class="metric-col">
        <div class="metric-title">Entradas Loja</div>
        <div id="metricEntradasLoja" class="metric-value">0</div>
      </div>
    </div>
  </section>

  <!-- Actions -->
  <section class="card actions-card" aria-label="A√ß√µes">
    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <button id="saveAndResetBtn" class="btn">Salvar Resumo & Resetar Dia</button>
      <button id="exportBtn" class="btn-ghost">Exportar Resumo (JSON)</button>
      <button id="viewHistoryBtn" class="btn-ghost">Ver Hist√≥rico de Dias</button>
    </div>

    <div id="historyPanel" class="history-panel mt-4 hidden" aria-live="polite"></div>
  </section>

  <!-- Final resumo (mini-cards) -->
  <section class="card final-resumo" aria-label="Resumo final">
    <h3 style="margin:0 0 8px 0;font-size:15px">Resumo Final por Categoria</h3>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:8px">
      <div style="background:linear-gradient(135deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));padding:12px;border-radius:12px;text-align:center">
        <div class="muted">Total Apps</div>
        <div id="finalTotalApps" class="metric-value">R$ 0,00</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));padding:12px;border-radius:12px;text-align:center">
        <div class="muted">Total Loja</div>
        <div id="finalTotalLoja" class="metric-value">R$ 0,00</div>
      </div>
      <div style="background:linear-gradient(135deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));padding:12px;border-radius:12px;text-align:center">
        <div class="muted">Total Doa√ß√µes</div>
        <div id="finalTotalDoacao" class="metric-value">R$ 0,00</div>
      </div>
      <div style="background:linear-gradient(135deg,var(--accent),#3b82f6);padding:12px;border-radius:12px;text-align:center;color:#fff">
        <div class="muted" style="opacity:0.9">Total Geral</div>
        <div id="finalTotalGeral" class="metric-value">R$ 0,00</div>
      </div>
    </div>
  </section>

  <footer class="small muted" style="text-align:center;margin-top:10px">Dados armazenados localmente (localStorage). Fa√ßa export regularmente.</footer>

</div> <!-- FIM .wrap -->

<!-- confetti holder -->
<div id="confettiRoot" class="confetti" aria-hidden="true"></div>

<!-- PARTE 3/3 - Firebase + Auth Guard + sync -->
<script type="module">
  // FIREBASE CORE (inicializa a app, auth e firestore)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Substitua por sua config caso queira (a mesma usada nas partes anteriores)
  const firebaseConfig = {
    apiKey: "AIzaSyBXkQlm0TbCsCdVGil8-5kGWbtj07SKXwA",
    authDomain: "maxrota.firebaseapp.com",
    projectId: "maxrota",
    storageBucket: "maxrota.firebasestorage.app",
    messagingSenderId: "425002957978",
    appId: "1:425002957978:web:1e4f38239e552de452f323",
    measurementId: "G-RBK7LM483D"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Exporta para o escopo global (os outros scripts acessam window.__FIREBASE__ e window.auth)
  window.__FIREBASE__ = { auth, db };
  window.auth = auth;
  window.db = db;

  // AUTH GUARD ‚Äî mant√©m comportamento esperado: redireciona se n√£o estiver logado, carrega estado se logado
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      // Se a rota atual for a p√°gina p√∫blica (login.html) n√£o redireciona em loop.
      // Caso queira sempre for√ßar login, descomente a linha abaixo.
      // location.href = "login.html";
      console.log("Usu√°rio n√£o autenticado.");
      window.__USER_UID__ = null;
      // Ainda assim, chama loadState para carregar local fallback (loadState est√° definido na PARTE 2).
      if (typeof loadState === 'function') await loadState();
      return;
    }
    // usu√°rio autenticado
    window.__USER_UID__ = user.uid;
    console.log("Usu√°rio autenticado:", user.uid);
    // carrega estado do Firebase (loadState deve existir na PARTE 2)
    if (typeof loadState === 'function') await loadState();
  });

  // LOGOUT ‚Äî exp√µe window.logout (PARTE 2 usa logout() no bot√£o)
  window.logout = async function() {
    try {
      await signOut(auth);
      window.__USER_UID__ = null;
      // limpa qualquer estado sens√≠vel local e redireciona para login
      // (descomente se quiser for√ßar a limpeza)
      // localStorage.removeItem('maxrota_state');
      location.href = "login.html";
    } catch (e) {
      console.error("Erro durante logout:", e);
      alert("N√£o foi poss√≠vel sair no momento.");
    }
  };

  // SINCRONIZA√á√ÉO PERI√ìDICA (toque leve) ‚Äî recarrega do Firebase a cada 15s se estiver logado
  setInterval(() => {
    if (!window.__USER_UID__) return;
    if (typeof loadState === 'function') {
      // loadState cuida de fallback para localStorage se houver erro
      loadState().catch(err => console.warn("Erro na sincroniza√ß√£o peri√≥dica:", err));
    }
  }, 15000);

  // Antes da janela fechar, salva estado local (garante backup)
  window.addEventListener('beforeunload', () => {
    try {
      if (typeof saveState === 'function') saveState();
    } catch (e) { /* ignore */ }
  });

  // Se precisar for√ßar uma primeira tentativa de carregamento quando o script for inserido
  // tenta carregar o estado local imediatamente (loadLocalState j√° foi chamada na PARTE 2).
  if (typeof loadState === 'function' && window.__USER_UID__) {
    loadState().catch(e => console.warn('loadState inicial falhou:', e));
  }
</script>
```Ó®Å0Ó®Ç
    
